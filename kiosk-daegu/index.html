<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1920x1080 터치스크린 등록</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; font-family: sans-serif; }
        .main-container { display: flex; flex-direction: column; width: 100vw; height: 100vh; }
        .top-spacer { height: 10%; width: 100%;}
        .image-top {width: 100%; height: 30%; display: flex; justify-content: center; align-items: center; background-color: #ffffff; padding-bottom:0; }
        .image-top img {width: auto; height: 80%; max-width: 90%; object-fit: contain; }
        .form-bottom { width: 100%; height: 70%; display: flex; justify-content: center; align-items: flex-start; }
        .content-box { width: 100%; max-width: 600px; text-align: center; }
        h1 { font-size: 48px; margin-bottom: 40px; }
        input { width: 100%; padding: 25px; font-size: 24px; margin-bottom: 20px; border: 2px solid #ddd; border-radius: 15px; outline: none; }
        button { width: 100%; padding: 30px; font-size: 32px; background-color: #007bff; color: white; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; }
        
        #receipt-print { display: none; }
        
        @media print {
            /* 1. 화면에 보이는 모든 요소를 숨깁니다. */
            body * {
                visibility: hidden;
            }
            
            /* 2. 영수증 부분(#receipt-print)과 그 자식 요소들만 보이게 합니다. */
            #receipt-print, #receipt-print * {
                visibility: visible;
                display: block !important; /* display:none을 강제로 해제 */
            }
            
            /* 3. 영수증을 화면 왼쪽 상단(0,0)에 딱 붙입니다. */
            #receipt-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 72mm; /* 영수증 프린터의 용지 폭에 맞게 조정 */
                padding: 0;
                margin: 0;
            }

            .receipt-inner {
                width: 72mm;
                padding: 5mm;
                box-sizing: border-box;
            }

            @page {
                size: 72mm auto; /* 용지 폭을 72mm로 고정, 길이는 내용에 따라 자동 */
                margin: 0; /* 페이지 여백 제거 */
            }
}
    </style>
</head>
<body>

    <div class="main-container">
        <div class="top-spacer"></div>
        <div class="image-top">
            <img src="tinkerwish.png" alt="상단 이미지">
        </div>
        <div class="form-bottom">
            <div class="content-box">
                <h1>재능마을, 팅커위시에 오신 것을 환영합니다!</h1>
                <input type="text" id="nameInput" placeholder="이름을 입력하세요">
                <input type="tel" id="phoneInput" inputmode="numeric" pattern=" [0-9]*" placeholder="전화번호를 입력하세요">
                <button onclick="registerUser()">등록하기</button>
            </div>
        </div>
    </div>
        <!-- 등록 완료 시 나타날 전체화면 레이어 -->
    <div id="finishLayer" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background-color:white; z-index:9999; justify-content:center; align-items:center;">
        <!-- 여기에 표시하고 싶은 완료 이미지 경로를 넣으세요 -->
        <img src="confirm.001.jpeg" alt="등록 완료" style="max-width: 80%; max-height: 80%;">
    </div>

    <!-- 영수증 인쇄용 컨테이너 (평소엔 숨김) -->
    <div id="receipt-print">
        <div class="receipt-inner">
            <h2 style="text-align: center; margin-bottom: 5px; font-size: 20px;">[팅커위시 TinkerWish]</h2>
            <p style="text-align: center; font-size: 12px; margin-bottom: 20px;">요정들의 재능마을</p>
            
            <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">
                아이 이름 : <span id="print-name"></span>
            </div>
            <div style="margin-bottom: 15px; font-size: 14px;">날개 레벨 : 1</div>

            <div style="margin-bottom: 10px; font-weight: bold; font-size: 14px;">오늘의 요정상점 (스티커 붙이기)</div>
            <div style="font-size: 13px; line-height: 1.8;">
                1) 정원의 요정 플로리 □<br>
                2) 과학의 요정 큐리 □<br>
                3) 리듬의 요정 멜리나 □<br>
                4) 협동의 요정 라온 □
            </div>

            <hr style="border: 0.5px solid #000; margin: 15px 0;">

            <div style="font-size: 11px; line-height: 1.4;">
                안내/주의사항<br>
                - 스티커는 체험 후 요정이 붙여드립니다.<br>
                - 보호자는 부모 라운지에서 대기해주세요.<br>
                - 체험 입장/이동 시 직원 안내에 따라주세요.<br>
                - 분실 시 재발급이 어려울 수 있어요.
            </div>
            
            <p id="print-date" style="text-align: center; font-size: 10px; margin-top: 20px;"></p>
        </div>
    </div>
<script>
const { ipcRenderer } = require('electron');

// [중요] 필터링 코드는 함수 밖으로 빼서 페이지가 열리자마자 작동해야 합니다.
const nameInput = document.getElementById('nameInput');
const phoneInput = document.getElementById('phoneInput');

// 1. 이름 필터링 (한글, 영어만)
nameInput.addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/[^a-zA-Zㄱ-ㅎㅏ-ㅣ가-힣]/g, '');
});

// 2. 전화번호 필터링 및 하이픈 자동 삽입
phoneInput.addEventListener('input', (e) => {
    let val = e.target.value.replace(/[^0-9]/g, '');
    
    if (val.length <= 3) {
        e.target.value = val;
    } else if (val.length <= 7) {
        e.target.value = val.slice(0, 3) + '-' + val.slice(3);
    } else {
        e.target.value = val.slice(0, 3) + '-' + val.slice(3, 7) + '-' + val.slice(7, 11);
    }
});
phoneInput.setAttribute('maxlength', '13'); // 최대 13자 제한


// 등록 버튼 클릭 시 실행되는 함수
function registerUser() {
    const name = nameInput.value;
    const phone = phoneInput.value;

    if (!name || !phone) {
        alert("정보를 모두 입력해 주세요.");
        return;
    }

    // 1. CSV 저장 요청
    ipcRenderer.send('save-to-csv', { name, phone });

    // 2. 영수증 데이터 매칭
    document.getElementById('print-name').innerText = name;
    document.getElementById('print-date').innerText = new Date().toLocaleString();

    // 3. 인쇄 실행
    ipcRenderer.send('print-silent');

    // 4. 완료 화면 표시
    const finishLayer = document.getElementById('finishLayer');
    finishLayer.style.display = 'flex'; 
    
    // 5. 2초 후 페이지 새로고침
    setTimeout(() => {
        location.reload(); 
    }, 2000);
}

</script>
</body>
</html>
